---
title: "Gov 50 Final Project"
author: "Kelly Olmos"
description: "My Final Project"
output:
  distill::distill_article:
    self_contained: false
---


## Project thoughts

Research Question: What is the relationship between a Republican candidate's stance on the 2020 election and their electoral success? In other words, consider how a Republican candidate's denial of the 2020 election results relates to their electoral success. 

For future: be more specific about the offices I'm refering to and word the research question better 

Formulate a hypothesis related to the research question. This hypothesis should be rooted in some sort of theory. In other words, you need to present a plausible story why the hypothesis might be true. Often, this is in the form of a behaviorial or institutional explanation. As social scientists, we are not interested in idiosyncratic explanations; we want to understand systematic patterns and relationships!

In Republican-leaning states, Republican candidates who deny the 2020 election results have greater electoral success and the opposite occurs in democratic-leaning states. 
[concede that this system is not perfect bc it is the aggregate of the state and we know that states can be politically fragmented with some urban centers being much more liberal than rural place maybe even use IL as an example]

Describe your explanatory variable(s) of interest and how it is measured. Importantly, we need to observe variation in this variable in order to study it!

The explanatory variable of interest is the Republican candidate's stance on the 2020 election results. It is a categorical variable measured 
"Candidates in the “Fully denied” category have explicitly said the 2020 election was illegitimate and/or took legal measures to try and overturn the election. Examples of the latter include members of Congress who voted against certifying election results or politicians who signed an amicus brief for a Texas lawsuit that challenged election results in four states President Biden won.
Candidates in the “Raised questions” category raised questions or concerns about the election but haven’t outright denied or affirmed it.
Candidates in the “Accepted with reservations” category have accepted Biden’s victory but have still raised questions or concerns about fraud.
Candidates in the “Fully accepted” category have accepted Biden’s victory without reservations.
Candidates in the “Avoided answering” category refused or avoided directly answering questions about the election (e.g., by changing the subject when asked about it).
Candidates in the “No comment” category have not made a public comment on the election (as far as we could tell) and did not respond to our inquiries on the topic." 
https://github.com/fivethirtyeight/data/tree/master/election-deniers

Describe your outcome variable of interest and how it is measured.
The outcome variable of interest is whether or not the Republican candidate won their race. 

What observed pattern in the data would provide support for your hypothesis? More importantly, what observed pattern would disprove your hypothesis?


Introduction: describe the research question and main hypothesis; describe why it is important. (1-2 paragraphs) (2pts)
Data section: 2-3 paragraphs + plot visualizing main outcome of interest. (3pts)

I want to investigate the relationship between the stance a Republican candidate takes on the results of the 2020 election and their electoral success in the 2022 general elections? 
How does the partisan lean of the state affect the answer to this question? 

Results section: plot of main analysis + regression output + 2-3 paragraphs of description and interpretation of the plots and regression (including interpreting the main coefficient of interest and describing if it is statistically significant and if we should interpret it causally). This section could be longer if you choose to include additional analyses. (8pts)
Conclusion section: 1 paragraph (i) summarizing results and assessing the extent to which you find support for your hypothesis; (ii) describing limitations of the analysis and threats to inference (missing data, confounding, etc), and stating how you could improve your analysis if you had more time/money. (2pts)

[finish later]

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(infer)

election_deniers <- read_csv("~/Downloads/fivethirtyeight_election_deniers_Gov50_final.csv")
```
```{r Making the data set neater by selecting and renaming variables}
election_data <- election_deniers |>
  select(Stance, `Dem or Rep State`, `Won or Lost their Race`, `The FiveThirtyEight partisan lean of every state`) 

election_data <- 
  rename(election_data, President = `Dem or Rep State`) |>
  rename(Elected_or_not = `Won or Lost their Race`) |>
  rename(State_partisan_lean = `The FiveThirtyEight partisan lean of every state`)

election_data
```
```{r eval = FALSE}
graph1 <- election_data |>
  ggplot(aes(x = State_partisan_lean, fill = Stance)) +
  geom_histogram()

graph1

# Create a boxplot using ggplot and dplyr
election_data |>
  filter(Stance == "Fully denied") |>
  ggplot(aes(x = Elected_or_not, y = State_partisan_lean, fill = Elected_or_not)) +
  geom_boxplot() +
  labs(title = "State Partisan Lean vs Election Outcome", x = "Elected or not", y = "State Partisan Lean")


# Create a contingency table
contingency_table <- table(election_data$Stance, election_data$Elected_or_not)

# Visualize using a stacked bar plot
barplot(contingency_table, beside = TRUE, legend = TRUE, col = c("red", "green"))

boxplot(election_data$State_partisan_lean ~ election_data$Elected_or_not, col = c("red", "green"), ylab = "State Partisan Lean")


# Create a boxplot using ggplot and dplyr
election_data %>%
  ggplot(aes(x = Stance, y = State_partisan_lean, fill = Stance)) +
  geom_boxplot() +
  labs(title = "Impact of State Partisan Lean on Stance", x = "Stance", y = "State Partisan Lean")

# Create a mosaic plot using ggplot2 and dplyr
election_data %>%
  ggplot(aes(x = Elected_or_not, fill = President)) +
  geom_bar(position = "fill") +
  coord_flip() +
  labs(title = "Election Outcome by State Vote", y = "Proportion", fill = "President")

# Fit a linear regression model
lm_model <- lm(State_partisan_lean ~ Stance + President, data = election_data)


```
x <- election_data |>
  filter(Stance == "Fully accepted") |>
  mutate(partisan_leaning = if_else(State_partisan_lean >= 0, "Conservative Leaning", "Liberal Leaning"),
         elected = if_else(Elected_or_not == "Elected", 1, 0)) |>
  group_by(partisan_leaning) |>
  summarise(elected_prop = mean(elected))
x

result <- inner_join(x, y, by = "partisan_leaning") |>
  mutate(diff_prop = elected_prop.x - elected_prop.y) |>
  select(partisan_leaning, diff_prop)

# Print the result
print(result)
```{r eval = FALSE}
election_data |>
  filter(President == "Trump")
```
s <- election_data |>
  slice
  mutate(partisan_leaning = if_else(State_partisan_lean >= 0, "Conservative Leaning", "Liberal Leaning"),
         elected = if_else(Elected_or_not == "Elected", 1, 0)) |>
  group_by(President) |>
  summarise(elected_prop = mean(elected))
s

result <- inner_join(y, s, by = "President") |>
  mutate(diff_prop = elected_prop.x - elected_prop.y) |>
  select(President, diff_prop)
result

boot_dist_infer <- election_data |>
  mutate(partisan_leaning = if_else(State_partisan_lean >= 0, "Conservative Leaning", "Liberal Leaning"),
         elected = if_else(Elected_or_not == "Elected", 1, 0)) |>
  specify(response = elected) |>
  generate(reps = 1000, type = "bootstrap") |>
  calculate(stat = "mean")
boot_dist_infer
visualize(boot_dist_infer)





null_dist <- social |>
  specify(elected ~ stance, success = "1") |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "diff in props", order = c("denied", "accepted"))

null_dist |>
  visualize()

ate_pval <- null_dist |>
    get_p_value(obs_stat = est_ate, direction = "both")
ate_pval

est_ate |>
  visualize() + shade_p_value(obs_stat = est_ate, direction = "both")

```{r}
#Is there a statistically significant difference in the proportion of Republican candidates who fully denied the results of the 2020 election between states with liberal partisan leaning and states with conservative partisan leanings. 

election_prop <- election_data |>
  mutate(partisan_leaning = if_else(State_partisan_lean >= 0, "Conservative Leaning", "Liberal Leaning"),
         elected = if_else(Elected_or_not == "Elected", 1, 0),
         stance = if_else(Stance == "Fully denied" | Stance == "Raised questions", "denied", "accepted")) |>
  group_by(stance) |>
  summarise(elected_prop = mean(elected))

election_prop

election_data_modified <- election_data |>
  mutate(partisan_leaning = if_else(State_partisan_lean >= 0, "Conservative Leaning", "Liberal Leaning"),
         elected = if_else(Elected_or_not == "Elected", "1", "0"),
         stance = if_else(Stance == "Fully denied" | Stance == "Raised questions", "denied", "accepted")) |>
  specify(elected ~ stance, success = "1") |>
  calculate(stat = "diff in props", order = c("denied", "accepted")) 

election_data_modified

set_hypothesis <- election_data |>
  mutate(elected = if_else(Elected_or_not == "Elected", "1", "0"),
         stance = if_else(Stance == "Fully denied" | Stance == "Raised questions", "denied", "accepted")) |>
  specify(elected ~ stance, success = "1") |> 
  hypothesize(null = "independence") 
  
set_hypothesis

null_dist <- set_hypothesis |>
  specify(elected ~ stance, success = "1") |> 
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "diff in props", order = c("denied", "accepted"))

null_dist

null_dist |>
  visualize()

ate_pval <- null_dist |>
  get_p_value(obs_stat = election_data_modified, direction = "both")
ate_pval
```




